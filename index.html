<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fabricas de Credito QUAC</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #FAFBFC;
  --white: #FFFFFF;
  --text: #1a1a2e;
  --text-secondary: #555770;
  --border: #E2E5EA;
  --border-light: #F0F1F4;
  --accent: #7633FF;
  --accent-bg: #F3EEFF;
  --red: #DC2626;
  --red-bg: #FEF2F2;
  --green: #16A34A;
  --green-bg: #F0FDF4;
  --amber: #D97706;
  --amber-bg: #FFFBEB;
  --violet: #7C3AED;
  --violet-bg: #F5F3FF;
  --code-bg: #F4F5F7;
  --sidebar-w: 260px;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
html { scroll-behavior: smooth; }
body {
  font-family: 'Plus Jakarta Sans', -apple-system, sans-serif;
  background: var(--bg);
  color: var(--text);
  line-height: 1.7;
  -webkit-font-smoothing: antialiased;
}

/* Sidebar */
.sidebar {
  position: fixed;
  top: 0;
  left: 0;
  width: var(--sidebar-w);
  height: 100vh;
  background: var(--white);
  border-right: 1px solid var(--border);
  overflow-y: auto;
  padding: 24px 0;
  z-index: 50;
}
.sidebar-title {
  font-size: 14px;
  font-weight: 700;
  color: var(--accent);
  padding: 0 20px;
  margin-bottom: 20px;
  letter-spacing: -0.01em;
}
.sidebar nav a {
  display: block;
  padding: 6px 20px;
  font-size: 13px;
  color: var(--text-secondary);
  text-decoration: none;
  border-left: 3px solid transparent;
  transition: all 0.15s;
}
.sidebar nav a:hover {
  color: var(--accent);
  background: var(--accent-bg);
  border-left-color: var(--accent);
}
.sidebar nav a.indent { padding-left: 36px; font-size: 12px; }
.sidebar nav a.active {
  color: var(--accent);
  font-weight: 600;
  border-left-color: var(--accent);
  background: var(--accent-bg);
}

/* Main */
.main {
  margin-left: var(--sidebar-w);
  max-width: 900px;
  padding: 48px 56px 120px;
}

/* Typography */
h1 {
  font-size: 32px;
  font-weight: 800;
  letter-spacing: -0.03em;
  line-height: 1.2;
  margin-bottom: 8px;
}
h2 {
  font-size: 24px;
  font-weight: 700;
  letter-spacing: -0.02em;
  margin-top: 56px;
  margin-bottom: 16px;
  padding-bottom: 8px;
  border-bottom: 2px solid var(--border);
}
h3 {
  font-size: 18px;
  font-weight: 600;
  margin-top: 32px;
  margin-bottom: 12px;
}
p { margin-bottom: 12px; color: var(--text-secondary); font-size: 15px; }
strong { color: var(--text); }

/* Meta */
.meta {
  display: flex;
  gap: 20px;
  flex-wrap: wrap;
  margin-bottom: 32px;
  padding-bottom: 24px;
  border-bottom: 1px solid var(--border);
}
.meta-item {
  font-size: 13px;
  color: var(--text-secondary);
}
.meta-item strong {
  font-weight: 600;
  color: var(--text);
}

/* Code / Diagrams */
pre {
  background: var(--code-bg);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 20px 24px;
  overflow-x: auto;
  margin: 16px 0 20px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 13px;
  line-height: 1.65;
  color: var(--text);
}
code {
  font-family: 'JetBrains Mono', monospace;
  font-size: 13px;
  background: var(--code-bg);
  padding: 2px 6px;
  border-radius: 4px;
}
pre code { background: none; padding: 0; }

/* Tables */
table {
  width: 100%;
  border-collapse: collapse;
  margin: 16px 0 20px;
  font-size: 13px;
}
th {
  background: var(--code-bg);
  font-weight: 600;
  text-align: left;
  padding: 10px 14px;
  border-bottom: 2px solid var(--border);
  font-size: 12px;
  text-transform: uppercase;
  letter-spacing: 0.04em;
  color: var(--text-secondary);
}
td {
  padding: 9px 14px;
  border-bottom: 1px solid var(--border-light);
  color: var(--text);
}
tr:hover td { background: var(--accent-bg); }

/* Lists */
ul, ol { margin: 8px 0 16px 24px; }
li {
  font-size: 15px;
  color: var(--text-secondary);
  margin-bottom: 4px;
}
li strong { color: var(--text); }

/* Badges */
.badge {
  display: inline-block;
  padding: 3px 10px;
  border-radius: 100px;
  font-size: 11px;
  font-weight: 600;
  letter-spacing: 0.03em;
}
.badge--accent { background: var(--accent-bg); color: var(--accent); }
.badge--red { background: var(--red-bg); color: var(--red); }
.badge--green { background: var(--green-bg); color: var(--green); }
.badge--amber { background: var(--amber-bg); color: var(--amber); }
.badge--violet { background: var(--violet-bg); color: var(--violet); }

/* Callouts */
.callout {
  border-radius: 8px;
  padding: 16px 20px;
  margin: 16px 0;
  font-size: 14px;
}
.callout p { margin-bottom: 4px; }
.callout--info { background: var(--accent-bg); border-left: 4px solid var(--accent); }
.callout--warn { background: var(--amber-bg); border-left: 4px solid var(--amber); }
.callout--danger { background: var(--red-bg); border-left: 4px solid var(--red); }
.callout--success { background: var(--green-bg); border-left: 4px solid var(--green); }

/* HR */
hr {
  border: none;
  border-top: 1px solid var(--border);
  margin: 40px 0;
}

/* ============================
   MOCKUPS DE PANTALLAS
   ============================ */
.mockups-row {
  display: flex;
  gap: 20px;
  flex-wrap: wrap;
  margin: 24px 0 32px;
}
.phone {
  width: 280px;
  flex-shrink: 0;
  background: var(--white);
  border: 2px solid var(--border);
  border-radius: 24px;
  padding: 20px;
  box-shadow: 0 4px 24px rgba(0,0,0,0.05);
  position: relative;
}
.phone::before {
  content: '';
  display: block;
  width: 80px;
  height: 4px;
  background: var(--border);
  border-radius: 2px;
  margin: 0 auto 16px;
}
.phone-step {
  font-size: 10px;
  font-weight: 600;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  color: var(--text-secondary);
  margin-bottom: 4px;
}
.phone-title {
  font-size: 15px;
  font-weight: 700;
  color: var(--text);
  margin-bottom: 10px;
  line-height: 1.3;
}
.phone-text {
  font-size: 12px;
  color: var(--text-secondary);
  margin-bottom: 12px;
  line-height: 1.5;
}
.phone-label {
  font-size: 11px;
  font-weight: 600;
  color: var(--text);
  margin-bottom: 4px;
  margin-top: 10px;
}
.phone-input {
  display: block;
  width: 100%;
  background: var(--code-bg);
  border: 1.5px solid var(--border);
  border-radius: 8px;
  padding: 9px 12px;
  font-size: 13px;
  font-family: 'Plus Jakarta Sans', sans-serif;
  color: var(--text-secondary);
  margin-bottom: 6px;
}
.phone-input--filled {
  background: var(--green-bg);
  border-color: var(--green);
  color: var(--green);
  font-weight: 500;
}
.phone-select {
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.phone-select::after { content: '▾'; font-size: 10px; }
.phone-btn {
  display: block;
  width: 100%;
  background: var(--accent);
  color: white;
  border: none;
  border-radius: 8px;
  padding: 10px;
  font-family: 'Plus Jakarta Sans', sans-serif;
  font-size: 14px;
  font-weight: 600;
  text-align: center;
  margin-top: 14px;
  cursor: default;
}
.phone-btn--danger { background: var(--red); }
.phone-btn--green { background: var(--green); }
.phone-check {
  display: flex;
  align-items: flex-start;
  gap: 8px;
  margin-bottom: 6px;
}
.phone-checkbox {
  width: 16px;
  height: 16px;
  border: 2px solid var(--border);
  border-radius: 4px;
  flex-shrink: 0;
  margin-top: 1px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 10px;
}
.phone-checkbox--checked {
  background: var(--accent);
  border-color: var(--accent);
  color: white;
}
.phone-check-text { font-size: 11px; color: var(--text-secondary); line-height: 1.4; }
.phone-divider {
  border: none;
  border-top: 1px solid var(--border-light);
  margin: 12px 0;
}
.phone-otp {
  display: flex;
  gap: 8px;
  justify-content: center;
  margin: 12px 0;
}
.phone-otp-box {
  width: 40px;
  height: 44px;
  border: 2px solid var(--border);
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  font-weight: 700;
  color: var(--text);
  font-family: 'JetBrains Mono', monospace;
}
.phone-loader {
  text-align: center;
  padding: 32px 0;
}
.phone-loader-spinner {
  width: 36px;
  height: 36px;
  border: 3px solid var(--border);
  border-top-color: var(--accent);
  border-radius: 50%;
  margin: 0 auto 12px;
  animation: spin 0.8s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }
.phone-loader-text {
  font-size: 13px;
  color: var(--text-secondary);
  font-weight: 500;
}
.phone-camera {
  background: #1a1a2e;
  border-radius: 12px;
  height: 160px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  margin: 8px 0;
  position: relative;
  overflow: hidden;
}
.phone-camera-frame {
  width: 120px;
  height: 80px;
  border: 2px dashed rgba(255,255,255,0.5);
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
}
.phone-camera-text {
  color: rgba(255,255,255,0.7);
  font-size: 11px;
  margin-top: 8px;
}
.phone-camera-icon {
  color: rgba(255,255,255,0.4);
  font-size: 28px;
}
.phone-result {
  text-align: center;
  padding: 16px 0;
}
.phone-result-icon { font-size: 48px; margin-bottom: 8px; }
.phone-result-amount {
  font-size: 28px;
  font-weight: 800;
  color: var(--accent);
  letter-spacing: -0.02em;
}
.phone-fields-captured {
  background: var(--code-bg);
  border-radius: 6px;
  padding: 8px 10px;
  margin-top: 8px;
}
.phone-fields-captured p {
  font-size: 10px;
  color: var(--text-secondary);
  margin: 0;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  margin-bottom: 4px;
}
.phone-fields-captured span {
  display: inline-block;
  font-size: 10px;
  background: var(--white);
  border: 1px solid var(--border);
  border-radius: 4px;
  padding: 2px 6px;
  margin: 1px;
  color: var(--text);
}
.phone-error {
  text-align: center;
  padding: 20px 0;
}
.phone-error-icon { font-size: 36px; margin-bottom: 8px; }
.phone-error-text { font-size: 13px; color: var(--red); font-weight: 500; line-height: 1.4; }

/* Responsive */
@media (max-width: 900px) {
  .sidebar { display: none; }
  .main { margin-left: 0; padding: 24px 20px 80px; }
  .mockups-row { flex-direction: column; align-items: center; }
  pre { font-size: 11px; padding: 14px 16px; }
}
</style>
</head>
<body>

<!-- Sidebar TOC -->
<aside class="sidebar">
  <div class="sidebar-title">QUAC — Fabricas de Credito</div>
  <nav>
    <a href="#generalidades">Generalidades</a>
    <a href="#origenes" class="indent">Origenes de solicitud</a>
    <a href="#s1">Flujo canal web</a>
    <a href="#flujo-actual" class="indent">Flujo actual</a>
    <a href="#s1-2" class="indent">Embudo de solicitudes</a>
    <a href="#opciones">Opciones de flujo evaluadas</a>
    <a href="#s2" class="indent">Opcion A: Descartar primero</a>
    <a href="#s2-diagram" class="indent">Diagrama detallado Opcion A</a>
    <a href="#s2-mockups" class="indent">Pantallas Opcion A</a>
    <a href="#s3-1" class="indent">Opcion B: Fotos tempranas</a>
    <a href="#s3-2" class="indent">Opcion C: TyC combinado</a>
    <a href="#s3-3" class="indent">Opcion D: OCR frontal (Recomendado)</a>
    <a href="#s3-3-mockups" class="indent">Pantallas Opcion D</a>
    <a href="#s4">Preguntas clave</a>
    <a href="#p1" class="indent">Timeout FOSIGA</a>
    <a href="#p2" class="indent">Email Ubica</a>
    <a href="#p3" class="indent">Retomar proceso</a>
  </nav>
</aside>

<!-- Main Content -->
<div class="main" id="top">

<h1>Fabricas de Credito QUAC</h1>
<div class="meta">
  <span class="meta-item"><strong>Proyecto:</strong> Fabricas de Credito</span>
  <span class="meta-item"><strong>Fecha:</strong> 2026-02-09</span>
</div>

<!-- ==================== GENERALIDADES ==================== -->
<h2 id="generalidades">Generalidades</h2>

<p>QUAC maneja todo el proceso de solicitud de cupo de credito a traves de un modulo llamado <strong>Fabricas</strong>, que hoy corre dentro del sistema Quac One. Este modulo se encarga de recibir la solicitud del cliente, validar su identidad, consultar centrales de riesgo y decidir si se le asigna cupo o no.</p>

<p>El modulo necesita una refactorizacion. Lo primero es confirmar como funcionan los flujos de navegacion en cada canal de solicitud, y a partir de ahi revisar el modelo de datos actual, los procedimientos almacenados que se usan y la arquitectura general del sistema.</p>

<h3 id="origenes">Origenes de solicitud de credito</h3>

<p>Existen 3 canales por los que un cliente puede solicitar cupo de credito QUAC. Aunque cada uno tiene particularidades en la interaccion, el flujo de validacion y aprobacion de fondo es el mismo:</p>

<div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(220px, 1fr));gap:16px;margin:20px 0 24px;">

  <div style="background:var(--accent-bg);border-radius:12px;padding:20px;border-left:4px solid var(--accent);">
    <div style="font-size:11px;font-weight:700;letter-spacing:0.08em;text-transform:uppercase;color:var(--accent);margin-bottom:6px;">Canal 1</div>
    <div style="font-size:17px;font-weight:700;margin-bottom:8px;">Web Online</div>
    <p style="font-size:13px;margin:0;">El cliente ingresa a <strong>preaprobado.quac.co</strong> y se autogestiona. El mismo ingresa sus datos, toma las fotos y completa todo el proceso sin asistencia.</p>
    <div style="margin-top:10px;font-size:11px;padding:4px 10px;background:var(--white);border-radius:100px;display:inline-block;font-weight:600;color:var(--accent);">Autoservicio</div>
  </div>

  <div style="background:var(--violet-bg);border-radius:12px;padding:20px;border-left:4px solid var(--violet);">
    <div style="font-size:11px;font-weight:700;letter-spacing:0.08em;text-transform:uppercase;color:var(--violet);margin-bottom:6px;">Canal 2</div>
    <div style="font-size:17px;font-weight:700;margin-bottom:8px;">Externos (Asesor de campo)</div>
    <p style="font-size:13px;margin:0;">Un asesor externo busca personas interesadas, abre el link desde su celular, se autentica con reconocimiento facial y va ingresando los datos del cliente en nombre de este.</p>
    <div style="margin-top:10px;font-size:11px;padding:4px 10px;background:var(--white);border-radius:100px;display:inline-block;font-weight:600;color:var(--violet);">Asesor guia el proceso</div>
  </div>

  <div style="background:var(--amber-bg);border-radius:12px;padding:20px;border-left:4px solid var(--amber);">
    <div style="font-size:11px;font-weight:700;letter-spacing:0.08em;text-transform:uppercase;color:var(--amber);margin-bottom:6px;">Canal 3</div>
    <div style="font-size:17px;font-weight:700;margin-bottom:8px;">Tienda fisica</div>
    <p style="font-size:13px;margin:0;">El cliente llega a una tienda a comprar y solicita el cupo en el momento. El cajero actua como asesor e ingresa la solicitud desde el sistema de punto de venta de la tienda.</p>
    <div style="margin-top:10px;font-size:11px;padding:4px 10px;background:var(--white);border-radius:100px;display:inline-block;font-weight:600;color:var(--amber);">En punto de venta</div>
  </div>

</div>

<hr>

<!-- ==================== SECCION 1 ==================== -->
<h2 id="s1">Flujo de navegacion — Canal Web</h2>

<p>Antes de proponer cambios, repasemos como funciona hoy el proceso de solicitud de cupo cuando un cliente ingresa por la web.</p>

<h3 id="flujo-actual">Flujo actual (preaprobadoquac-client)</h3>

<pre><code>1. Documento (CC) + TyC checkbox
2. Celular
3. OTP SMS
4. Datos personales (nombre, apellidos, email)
5. Fecha expedicion documento → dispara consulta a Preselecta (DataCredito)
6a. CrossCore cuestionario (condicional)
6b. CrossCore OTP (condicional)
7. Resultado: Aprobado / Rechazado</code></pre>

<p><strong>Caracteristicas:</strong></p>
<ul>
  <li>La captura de fotos y prueba de vida no hace parte de este flujo. Existe un proceso aparte llamado "activacion de cupo" que se encarga de eso</li>
  <li>No hay validacion de antecedentes judiciales</li>
  <li>No hay validacion FOSIGA</li>
  <li>No hay verificacion Ubica</li>
  <li>No recopila datos de residencia (departamento, ciudad, direccion, barrio)</li>
  <li>CrossCore es el unico mecanismo de verificacion de identidad</li>
</ul>

<!-- EMBUDO -->
<h2 id="s1-2">Embudo de solicitudes</h2>

<p>Consultando la base de datos <code>quacapi.credit_request</code> de los ultimos 6 meses, se identifico el embudo real de conversion:</p>

<h3>Solicitudes por mes y resultado de Preselecta</h3>

<table>
  <thead>
    <tr><th>Mes</th><th>Solicitudes</th><th>Llegaron a Preselecta</th><th>% que llega</th><th>Viables</th><th>No viables</th><th>% viable (de Preselecta)</th></tr>
  </thead>
  <tbody>
    <tr><td>Feb 2026 (parcial)</td><td>1,698</td><td>674</td><td>39.7%</td><td><strong style="color:var(--green)">180</strong></td><td><strong style="color:var(--red)">434</strong></td><td>26.7%</td></tr>
    <tr><td><strong>Ene 2026</strong></td><td><strong>5,493</strong></td><td><strong>2,520</strong></td><td><strong>45.9%</strong></td><td><strong style="color:var(--green)">709</strong></td><td><strong style="color:var(--red)">1,696</strong></td><td><strong>28.1%</strong></td></tr>
    <tr><td>Dic 2025</td><td>9,999</td><td>4,457</td><td>44.6%</td><td><strong style="color:var(--green)">1,226</strong></td><td><strong style="color:var(--red)">3,033</strong></td><td>27.5%</td></tr>
    <tr><td>Nov 2025</td><td>8,821</td><td>3,990</td><td>45.2%</td><td><strong style="color:var(--green)">1,615</strong></td><td><strong style="color:var(--red)">2,276</strong></td><td>40.5%</td></tr>
    <tr><td>Oct 2025</td><td>9,386</td><td>4,119</td><td>43.9%</td><td><strong style="color:var(--green)">1,475</strong></td><td><strong style="color:var(--red)">2,548</strong></td><td>35.8%</td></tr>
    <tr><td>Sep 2025</td><td>9,936</td><td>4,093</td><td>41.2%</td><td><strong style="color:var(--green)">997</strong></td><td><strong style="color:var(--red)">2,008</strong></td><td>24.4%</td></tr>
  </tbody>
</table>

<p><strong>Criterio:</strong> Se considera que una solicitud llego a Preselecta si <code>response_preselected_json IS NOT NULL</code>. Se considera viable si <code>response_preselected_status = 1</code>.</p>

<h3>Embudo tipico (enero 2026)</h3>

<pre><code>5,493 solicitudes inician
  │
  ├─ 2,973 (54%) nunca llegan a Preselecta
  │   (abandono, expiracion, validaciones previas fallidas)
  │
  ▼
2,520 llegan a Preselecta (46%)
  │
  ├─ 1,696 (67%) NO viables
  │
  ▼
  709 viables (28% de Preselecta, 13% del total)</code></pre>

<h3>Hallazgos clave</h3>
<ol>
  <li><strong>Solo el ~13% de las solicitudes resultan viables.</strong> Si las fotos y validaciones que generan costo (Rekognition, Ubica) van despues de Preselecta, nos ahorramos ese gasto en el 87% de los casos.</li>
  <li><strong>El ~54% de las solicitudes ni siquiera llegan a Preselecta.</strong> Se pierden antes por abandono, expiracion o validaciones iniciales fallidas.</li>
  <li><strong>De las que llegan a Preselecta, el ~67% no son viables.</strong> Este dato incluye tanto rechazos reales como posibles consultas desperdiciadas por datos incorrectos (primer apellido mal escrito, por ejemplo). No es posible distinguirlos con la data actual, pero es exactamente el riesgo que justifica capturar el primer apellido via OCR antes de consultar Preselecta.</li>
  <li><strong>El volumen mensual oscila entre 5,000 y 10,000 solicitudes</strong>, lo cual hace que cualquier ahorro por solicitud sea significativo.</li>
</ol>

<div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(180px, 1fr));gap:14px;margin:28px 0 8px;">
  <div style="background:var(--white);border:1px solid var(--border);border-radius:12px;padding:20px;text-align:center;">
    <div style="font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.08em;color:var(--text-secondary);margin-bottom:8px;">Solicitudes / mes</div>
    <div style="font-size:36px;font-weight:800;color:var(--accent);letter-spacing:-0.03em;line-height:1;">5K–10K</div>
  </div>
  <div style="background:var(--white);border:1px solid var(--border);border-radius:12px;padding:20px;text-align:center;">
    <div style="font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.08em;color:var(--text-secondary);margin-bottom:8px;">No llegan a Preselecta</div>
    <div style="font-size:36px;font-weight:800;color:var(--red);letter-spacing:-0.03em;line-height:1;">54%</div>
    <div style="font-size:12px;color:var(--text-secondary);margin-top:4px;">abandono, expiracion, validaciones</div>
  </div>
  <div style="background:var(--white);border:1px solid var(--border);border-radius:12px;padding:20px;text-align:center;">
    <div style="font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.08em;color:var(--text-secondary);margin-bottom:8px;">No viables en Preselecta</div>
    <div style="font-size:36px;font-weight:800;color:var(--amber);letter-spacing:-0.03em;line-height:1;">67%</div>
    <div style="font-size:12px;color:var(--text-secondary);margin-top:4px;">de las que llegan</div>
  </div>
  <div style="background:var(--white);border:1px solid var(--border);border-radius:12px;padding:20px;text-align:center;">
    <div style="font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.08em;color:var(--text-secondary);margin-bottom:8px;">Viables del total</div>
    <div style="font-size:36px;font-weight:800;color:var(--green);letter-spacing:-0.03em;line-height:1;">13%</div>
    <div style="font-size:12px;color:var(--text-secondary);margin-top:4px;">709 de 5,493 (ene 2026)</div>
  </div>
</div>

<hr>

<!-- ==================== OPCIONES ==================== -->
<h2 id="opciones">Opciones de flujo evaluadas</h2>

<p>Teniendo en cuenta el flujo actual y los datos del embudo, se exploraron las siguientes opciones para el nuevo flujo:</p>

<ul>
  <li><strong>Opcion A:</strong> "Descartar primero lo que no cuesta" — datos manuales primero, validaciones con costo despues</li>
  <li><strong>Opcion B:</strong> Fotos tempranas — capturar las 3 fotos antes de Preselecta</li>
  <li><strong>Opcion C:</strong> TyC combinado con datos basicos — un solo formulario con todo</li>
  <li><strong>Opcion D:</strong> Foto frontal temprana para OCR — solo la foto frontal antes de Preselecta <span class="badge badge--accent">RECOMENDADA</span></li>
</ul>

<p>A continuacion el detalle de cada una.</p>

<hr>

<h3 id="s2">Opcion A: "Descartar primero lo que no cuesta"</h3>

<p>Optimiza la experiencia del usuario minimizando abandono y valida lo mas economico primero antes de consumir servicios pagos (Preselecta, FOSIGA, Ubica, Rekognition).</p>

<pre><code>FASE 1: IDENTIFICACION Y VALIDACIONES RAPIDAS (sin costo)
  ① Tipo documento + Numero documento
  ② Validaciones automaticas (cartera activa, proceso activo)

FASE 2: CONSENTIMIENTO LEGAL (requerido antes de cualquier consulta a centrales)
  ③ Terminos y condiciones (4 politicas)
  ④ Celular + validacion duplicado
  ⑤ OTP SMS → firma electronica TyC

FASE 3: DATOS DEL CLIENTE
  ⑥ Fecha expedicion documento
  ⑦ Datos personales (nombre, apellidos, nacimiento, genero, email)
  ⑧ Datos de residencia (departamento, ciudad, direccion, barrio)

FASE 4: VALIDACIONES DE FONDO (con costo)
  ⑨ Antecedentes judiciales
  ⑩ Viabilidad crediticia (Preselecta) → requiere: doc + primer apellido + fecha exp
  ⑪ FOSIGA (condicional: edad > X && viable != 1)

FASE 5: VERIFICACION DE IDENTIDAD DOCUMENTAL
  ⑫ Prueba de vida (selfie)
  ⑬ Foto frontal documento
  ⑭ Foto reverso documento
  ⑮ Validacion AWS Rekognition (rostro, documento, comparacion)

FASE 6: VERIFICACION DE IDENTIDAD UBICA
  ⑯ Consulta Ubica (celular + email de centrales)
  ⑰ OTP al celular reportado por Ubica (si difiere del registrado)
  ⑱ OTP al email reportado por Ubica

FASE 7: RESULTADO
  ⑲ Asignacion de cupo → pantalla de resultado</code></pre>

<h3 id="s2-diagram">Diagrama Detallado</h3>

<pre><code>  ┌─────────────────────────────────────────────────────┐
  │  FASE 1: IDENTIFICACION                             │
  │                                                     │
  │  ① Tipo doc + Nro doc                               │
  │     [Continuar]                                     │
  │         │                                           │
  │         ▼                                           │
  │  ② Loader "Validando informacion..."                │
  │     ├─ GET Cartera/Resumen/{doc}/{business}         │
  │     │  → Si tiene cupo activo → FIN (mensaje)       │
  │     ├─ POST Credito/ConsultarProcesoSolicitud       │
  │     │  → Si tiene proceso activo < 90 dias → FIN    │
  │     └─ Guardar log                                  │
  └────────────────────┬────────────────────────────────┘
                       │ OK
                       ▼
  ┌─────────────────────────────────────────────────────┐
  │  FASE 2: CONSENTIMIENTO LEGAL                       │
  │                                                     │
  │  ③ Terminos y condiciones                           │
  │     □ Politica de tratamiento de datos              │
  │     □ Autorizacion consulta centrales de riesgo     │
  │     □ Contrato de credito                           │
  │     □ Contrato de fianza                            │
  │     [✓ Acepto] [Continuar]                          │
  │         │                                           │
  │         ▼                                           │
  │  ④ Ingresa numero de celular                        │
  │     [Continuar]                                     │
  │         │                                           │
  │         ▼                                           │
  │     Loader "Validando informacion..."               │
  │     ├─ POST Cliente/Control (celular duplicado)     │
  │     │  → Si duplicado → FIN (mensaje)               │
  │     ├─ Enviar OTP al celular (Infobip SMS)          │
  │     ├─ Guardar en credit_request                    │
  │     └─ POST Cliente/Basico (crear tercero)          │
  │         │                                           │
  │         ▼                                           │
  │  ⑤ Verificacion OTP                                 │
  │     "Hemos enviado un codigo SMS al [CELULAR]"      │
  │     [____] [Continuar]                              │
  │     → Validar token correcto                        │
  │     → Guardar aceptacion TyC con fecha/hora         │
  └────────────────────┬────────────────────────────────┘
                       │ OK
                       ▼
  ┌─────────────────────────────────────────────────────┐
  │  FASE 3: DATOS DEL CLIENTE                          │
  │                                                     │
  │  ⑥ Fecha expedicion documento                       │
  │     Nro doc (readonly) + [dia] [mes] [ano]          │
  │     [Continuar]                                     │
  │     → Guardar en credit_request                     │
  │     → POST Cliente/Basico (actualizar fecha exp)    │
  │         │                                           │
  │         ▼                                           │
  │  ⑦ Datos personales                                 │
  │     Nombre + Primer apellido + Segundo apellido     │
  │     Fecha nacimiento + Genero + Email               │
  │     [Continuar]                                     │
  │     → Guardar en credit_request                     │
  │     → POST Cliente/Basico (actualizar datos)        │
  │         │                                           │
  │         ▼                                           │
  │  ⑧ Datos de residencia                              │
  │     Departamento + Ciudad + Direccion + Barrio      │
  │     [Continuar]                                     │
  │     → Guardar en credit_request                     │
  │     → POST Cliente/ (actualizar direccion)          │
  └────────────────────┬────────────────────────────────┘
                       │ OK
                       ▼
  ┌─────────────────────────────────────────────────────┐
  │  FASE 4: VALIDACIONES DE FONDO                      │
  │                                                     │
  │  Loader "Procesando solicitud..."                   │
  │                                                     │
  │  ⑨ POST Cliente/Antecedentes                        │
  │     → Si tiene antecedentes → FIN (mensaje)         │
  │         │                                           │
  │         ▼                                           │
  │  ⑩ POST Preselecta/ConsultarPreselecta              │
  │     → Si viable = 0 (no viable) → FIN (mensaje)    │
  │         │                                           │
  │         ▼                                           │
  │  ⑪ Si edad > X && viable != 1:                      │
  │     POST FOSIGA (cotizacion)                        │
  │     → Si no cotiza → FIN (mensaje)                  │
  │     → Puede tardar hasta 2 min                      │
  └────────────────────┬────────────────────────────────┘
                       │ OK
                       ▼
  ┌─────────────────────────────────────────────────────┐
  │  FASE 5: VERIFICACION DOCUMENTAL                    │
  │  (Integra activacion-quac-client)                   │
  │                                                     │
  │  Texto: "Realiza una breve verificacion facial..."  │
  │                                                     │
  │  ⑫ Prueba de vida (selfie)                          │
  │     POST photos/validate-selfie                     │
  │     → DetectFaces, SearchFacesByImage (fraude)      │
  │     → Si no pasa → FIN                              │
  │         │                                           │
  │         ▼                                           │
  │  ⑬ Foto frontal documento                           │
  │     POST photos/validate-front-document             │
  │     → DetectLabels, CompareFaces, DetectText        │
  │         │                                           │
  │         ▼                                           │
  │  ⑭ Foto reverso documento                           │
  │     POST photos/validate-reverse-document           │
  │     → DetectLabels, DetectText                      │
  │     → Extraer datos y comparar con lo ingresado     │
  │     → Generar calificacion IA (0-100)               │
  └────────────────────┬────────────────────────────────┘
                       │ OK
                       ▼
  ┌─────────────────────────────────────────────────────┐
  │  FASE 6: VERIFICACION UBICA                         │
  │                                                     │
  │  ⑯ Consulta Ubica → obtiene celular + email         │
  │     → Si Ubica no arroja info → "Validacion         │
  │       pendiente, un asesor te contactara"           │
  │         │                                           │
  │         ▼                                           │
  │  ⑰ Si celular Ubica != celular registrado:          │
  │     OTP al celular Ubica                            │
  │     "Codigo enviado a 318****006"                   │
  │         │                                           │
  │         ▼                                           │
  │  ⑱ OTP al email Ubica                               │
  │     "Codigo enviado a ****@gmail.com"               │
  └────────────────────┬────────────────────────────────┘
                       │ OK
                       ▼
  ┌─────────────────────────────────────────────────────┐
  │  FASE 7: RESULTADO                                  │
  │                                                     │
  │  ⑲ POST Credito/AsignarPrecupo                      │
  │     → "Felicidades! Tu credito ha sido              │
  │        pre-aprobado. Cupo: $X.XXX.XXX"              │
  │     → "Para activar, acercate a una tienda          │
  │        o realiza tu primera compra en linea"        │
  └─────────────────────────────────────────────────────┘</code></pre>

<!-- MOCKUPS OPCION A -->
<h3 id="s2-mockups">Simulacion de pantallas — Opcion A</h3>
<p>Referencia visual de cada pantalla del flujo. Los campos en <span class="badge badge--green">verde</span> indican datos que se guardan en <code>credit_request</code>.</p>

<div class="mockups-row">

  <!-- Paso 1 -->
  <div class="phone">
    <div class="phone-step">Fase 1 — Paso 1</div>
    <div class="phone-title">Solicitud de credito</div>
    <div class="phone-text">Para iniciar tu solicitud de credito, necesitamos algunos datos basicos.</div>
    <div class="phone-label">Tipo de documento</div>
    <div class="phone-input phone-select">Cedula de Ciudadania</div>
    <div class="phone-label">Numero de documento</div>
    <div class="phone-input">1.234.567.890</div>
    <div class="phone-btn">Continuar</div>
    <div class="phone-fields-captured">
      <p>Campos capturados</p>
      <span>document_type</span> <span>document_number</span>
    </div>
  </div>

  <!-- Loader validacion -->
  <div class="phone">
    <div class="phone-step">Fase 1 — Paso 2</div>
    <div class="phone-title">Validacion inicial</div>
    <div class="phone-loader">
      <div class="phone-loader-spinner"></div>
      <div class="phone-loader-text">Validando informacion...</div>
    </div>
    <div style="font-size:11px;color:var(--text-secondary);line-height:1.5;margin-top:8px;">
      <strong>Validaciones:</strong><br>
      ✓ GET Cartera/Resumen/{doc}<br>
      ✓ POST Credito/ConsultarProcesoSolicitud<br>
      ✓ Guardar log
    </div>
  </div>

  <!-- Paso 3: TyC -->
  <div class="phone">
    <div class="phone-step">Fase 2 — Paso 3</div>
    <div class="phone-title">Terminos y condiciones</div>
    <div class="phone-text">Para continuar, acepta los terminos y condiciones:</div>
    <div class="phone-check">
      <div class="phone-checkbox phone-checkbox--checked">✓</div>
      <span class="phone-check-text">Politica de tratamiento de datos</span>
    </div>
    <div class="phone-check">
      <div class="phone-checkbox phone-checkbox--checked">✓</div>
      <span class="phone-check-text">Autorizacion consulta a centrales de riesgo</span>
    </div>
    <div class="phone-check">
      <div class="phone-checkbox phone-checkbox--checked">✓</div>
      <span class="phone-check-text">Contrato de credito</span>
    </div>
    <div class="phone-check">
      <div class="phone-checkbox phone-checkbox--checked">✓</div>
      <span class="phone-check-text">Contrato de fianza</span>
    </div>
    <div class="phone-btn">Acepto y continuo</div>
  </div>

</div>

<div class="mockups-row">

  <!-- Paso 4: Celular -->
  <div class="phone">
    <div class="phone-step">Fase 2 — Paso 4</div>
    <div class="phone-title">Numero de celular</div>
    <div class="phone-text">Usaremos tu numero para enviarte un codigo de verificacion y confirmar tu aceptacion de los terminos.</div>
    <div class="phone-label">Celular</div>
    <div class="phone-input">318 456 7890</div>
    <div class="phone-btn">Continuar</div>
    <div class="phone-fields-captured">
      <p>Campos capturados</p>
      <span>phone</span>
    </div>
  </div>

  <!-- Paso 5: OTP -->
  <div class="phone">
    <div class="phone-step">Fase 2 — Paso 5</div>
    <div class="phone-title">Verificacion OTP</div>
    <div class="phone-text">Hemos enviado un codigo SMS al numero <strong>318 *** 890</strong>. Una vez lo recibas ingresalo.</div>
    <div class="phone-otp">
      <div class="phone-otp-box">4</div>
      <div class="phone-otp-box">7</div>
      <div class="phone-otp-box">2</div>
      <div class="phone-otp-box">9</div>
    </div>
    <div style="text-align:center;margin-bottom:8px;">
      <a style="font-size:12px;color:var(--accent);text-decoration:none;">Reenviar codigo</a>
       ·
      <a style="font-size:12px;color:var(--accent);text-decoration:none;">Llamar al celular</a>
    </div>
    <div class="phone-btn">Verificar</div>
    <div class="phone-fields-captured">
      <p>Campos capturados</p>
      <span>tyc_accepted_at</span> <span>tyc_otp_validated</span>
    </div>
  </div>

  <!-- Paso 6: Fecha exp -->
  <div class="phone">
    <div class="phone-step">Fase 3 — Paso 6</div>
    <div class="phone-title">Fecha de expedicion</div>
    <div class="phone-text">Confirma la fecha de expedicion de tu cedula.</div>
    <div class="phone-label">Numero de documento</div>
    <div class="phone-input" style="background:var(--code-bg);opacity:0.7;">1.234.567.890 (solo lectura)</div>
    <div class="phone-label">Fecha de expedicion</div>
    <div style="display:flex;gap:6px;">
      <div class="phone-input" style="flex:1;text-align:center;">15</div>
      <div class="phone-input" style="flex:1;text-align:center;">Mar</div>
      <div class="phone-input" style="flex:1;text-align:center;">2015</div>
    </div>
    <div class="phone-btn">Continuar</div>
    <div class="phone-fields-captured">
      <p>Campos capturados</p>
      <span>expedition_date</span>
    </div>
  </div>

</div>

<div class="mockups-row">

  <!-- Paso 7: Datos personales -->
  <div class="phone">
    <div class="phone-step">Fase 3 — Paso 7</div>
    <div class="phone-title">Datos personales</div>
    <div class="phone-label">Nombre</div>
    <div class="phone-input">Francisco</div>
    <div class="phone-label">Primer apellido</div>
    <div class="phone-input">Garcia</div>
    <div class="phone-label">Segundo apellido</div>
    <div class="phone-input">Martinez</div>
    <div class="phone-label">Fecha de nacimiento</div>
    <div class="phone-input">01/05/1990</div>
    <div class="phone-label">Genero</div>
    <div class="phone-input phone-select">Masculino</div>
    <div class="phone-label">Correo electronico</div>
    <div class="phone-input">francisco@email.com</div>
    <div class="phone-btn">Continuar</div>
    <div class="phone-fields-captured">
      <p>Campos capturados</p>
      <span>first_name</span> <span>last_name</span> <span>second_last_name</span> <span>birth_date</span> <span>gender_id</span> <span>email</span>
    </div>
  </div>

  <!-- Paso 8: Residencia -->
  <div class="phone">
    <div class="phone-step">Fase 3 — Paso 8</div>
    <div class="phone-title">Datos de residencia</div>
    <div class="phone-label">Departamento</div>
    <div class="phone-input phone-select">Cundinamarca</div>
    <div class="phone-label">Ciudad</div>
    <div class="phone-input phone-select">Bogota</div>
    <div class="phone-label">Direccion</div>
    <div class="phone-input">Cra 45 # 23-10</div>
    <div class="phone-label">Barrio</div>
    <div class="phone-input">Chapinero</div>
    <div class="phone-btn">Continuar</div>
    <div class="phone-fields-captured">
      <p>Campos capturados</p>
      <span>department</span> <span>city</span> <span>address</span> <span>neighborhood</span>
    </div>
  </div>

  <!-- Paso 9-11: Validaciones de fondo -->
  <div class="phone">
    <div class="phone-step">Fase 4 — Pasos 9, 10, 11</div>
    <div class="phone-title">Validaciones de fondo</div>
    <div class="phone-loader">
      <div class="phone-loader-spinner"></div>
      <div class="phone-loader-text">Procesando solicitud...</div>
    </div>
    <div style="font-size:11px;color:var(--text-secondary);line-height:1.8;margin-top:8px;">
      <strong>Secuencia:</strong><br>
      ⑨ POST Cliente/Antecedentes<br>
      <span style="color:var(--red)">→ Si antecedentes → FIN</span><br>
      ⑩ POST Preselecta/ConsultarPreselecta<br>
      <span style="color:var(--red)">→ Si no viable → FIN</span><br>
      ⑪ POST FOSIGA (si edad > X && viable != 1)<br>
      <span style="color:var(--red)">→ Si no cotiza → FIN</span>
    </div>
  </div>

</div>

<div class="mockups-row">

  <!-- Paso 12: Selfie -->
  <div class="phone">
    <div class="phone-step">Fase 5 — Paso 12</div>
    <div class="phone-title">Prueba de vida</div>
    <div class="phone-text">Mira directamente a la camara. Mantente quieto.</div>
    <div class="phone-camera">
      <div class="phone-camera-frame">
        <div class="phone-camera-icon">&#128100;</div>
      </div>
      <div class="phone-camera-text">Centra tu rostro en el marco</div>
    </div>
    <div class="phone-btn">Validacion Facial</div>
  </div>

  <!-- Paso 13: Foto frontal -->
  <div class="phone">
    <div class="phone-step">Fase 5 — Paso 13</div>
    <div class="phone-title">Foto frontal documento</div>
    <div class="phone-text">Ubica la parte frontal de tu cedula dentro del marco.</div>
    <div class="phone-camera">
      <div class="phone-camera-frame" style="width:150px;height:95px;">
        <div style="color:rgba(255,255,255,0.3);font-size:11px;text-align:center;">CEDULA DE<br>CIUDADANIA</div>
      </div>
      <div class="phone-camera-text">Usa la camara trasera</div>
    </div>
    <div class="phone-btn">Capturar foto</div>
  </div>

</div>

<div class="mockups-row">

  <!-- Paso 16: Ubica intro -->
  <div class="phone">
    <div class="phone-step">Fase 6 — Paso 16</div>
    <div class="phone-title">Verificacion de identidad</div>
    <div class="phone-text">Hola <strong>FRANCISCO</strong>, a continuacion necesitamos verificar tu identidad. Este proceso es sencillo, seguro y necesario para avanzar con tu solicitud de credito.</div>
    <div class="phone-btn">Continuar</div>
    <div style="font-size:11px;color:var(--text-secondary);line-height:1.8;margin-top:12px;">
      <strong>Proceso:</strong><br>
      Consulta Ubica → obtiene celular y email registrados en centrales de riesgo
    </div>
    <div class="phone-fields-captured">
      <p>Campos capturados</p>
      <span>ubica_phone</span> <span>ubica_email</span>
    </div>
  </div>

  <!-- Paso 17: OTP celular Ubica -->
  <div class="phone">
    <div class="phone-step">Fase 6 — Paso 17</div>
    <div class="phone-title">Token al celular</div>
    <div class="phone-text">Hemos enviado un codigo SMS al numero <strong>320 *** 456</strong> registrado en tu historia crediticia. Una vez lo recibas ingresalo.</div>
    <div class="phone-otp">
      <div class="phone-otp-box">_</div>
      <div class="phone-otp-box">_</div>
      <div class="phone-otp-box">_</div>
      <div class="phone-otp-box">_</div>
    </div>
    <div style="text-align:center;margin-bottom:8px;">
      <a style="font-size:12px;color:var(--accent);text-decoration:none;">Reenviar codigo</a>
    </div>
    <div class="phone-btn">Verificar</div>
    <div class="phone-fields-captured">
      <p>Campos capturados</p>
      <span>ubica_phone_otp_validated</span>
    </div>
  </div>

  <!-- Paso 18: OTP email Ubica -->
  <div class="phone">
    <div class="phone-step">Fase 6 — Paso 18</div>
    <div class="phone-title">Token al correo electronico</div>
    <div class="phone-text">Hemos enviado un codigo al correo <strong>f****@gmail.com</strong> registrado en tu historia crediticia. Una vez lo recibas ingresalo.</div>
    <div class="phone-otp">
      <div class="phone-otp-box">_</div>
      <div class="phone-otp-box">_</div>
      <div class="phone-otp-box">_</div>
      <div class="phone-otp-box">_</div>
    </div>
    <div style="text-align:center;margin-bottom:8px;">
      <a style="font-size:12px;color:var(--accent);text-decoration:none;">Reenviar codigo</a>
    </div>
    <div class="phone-btn">Verificar</div>
    <div class="phone-fields-captured">
      <p>Campos capturados</p>
      <span>ubica_email_otp_validated</span>
    </div>
  </div>

</div>

<div class="mockups-row">

  <!-- Paso 19: Resultado -->
  <div class="phone">
    <div class="phone-step">Fase 7 — Paso 19</div>
    <div class="phone-title" style="text-align:center;">Resultado</div>
    <div class="phone-result">
      <img src="assets/quac-1.png" alt="QUAC" style="width:100px;height:auto;margin:0 auto;display:block;">
      <div style="font-size:16px;font-weight:700;color:var(--green);margin-bottom:8px;">¡Felicidades!</div>
      <div style="font-size:13px;color:var(--text-secondary);margin-bottom:12px;">Tu credito ha sido pre-aprobado</div>
      <div class="phone-result-amount">$1.000.000</div>
      <div style="font-size:12px;color:var(--text-secondary);margin-top:12px;line-height:1.5;">Para activar tu credito, acercate a una tienda fisica o realiza tu primera compra en linea.</div>
    </div>
  </div>

</div>

<div class="callout callout--danger">
  <p><strong>Limitacion de la Opcion A:</strong> El primer apellido lo escribe el usuario manualmente. Si lo escribe mal (ambos apellidos juntos, tildes incorrectas, abreviaciones), la consulta a Preselecta se desperdicia. Esta limitacion se resuelve con la Opcion D.</p>
</div>

<hr>

<!-- ==================== SECCION 3 ==================== -->
<h3 id="s3-1">Opcion B: Fotos Tempranas (despues de documento)</h3>

<p><strong>Propuesto por:</strong> Miembro del equipo<br>
<strong>Concepto:</strong> Capturar fotos inmediatamente despues del tipo/numero de documento.</p>

<pre><code>① Tipo doc + Nro doc
② Validaciones automaticas (cartera, proceso activo)
③ TyC + celular + OTP (firma)
④ Prueba de vida + fotos documento ← MOVIDO AQUI
⑤ Extraer datos del documento con IA → autocompletar formularios
⑥ Confirmar datos extraidos (nombre, apellidos, fecha exp, nacimiento)
⑦ Completar datos faltantes (email, genero, residencia)
⑧ Validaciones de fondo (antecedentes, Preselecta, FOSIGA)
⑨ Ubica
⑩ Resultado</code></pre>

<p><strong>Ventajas:</strong></p>
<ul>
  <li>Se puede extraer datos del documento con IA y autocompletar formularios → menos errores de tipeo</li>
  <li>El primer apellido se extrae del documento, evitando el problema de Preselecta con apellidos mal escritos</li>
  <li>Reduce errores humanos en datos criticos (fecha expedicion, nombres)</li>
</ul>

<p><strong>Desventajas:</strong></p>
<ul>
  <li>Mayor friccion inicial → mayor tasa de abandono en pasos tempranos</li>
  <li>Se consume AWS Rekognition ($$$) <strong>ANTES</strong> de saber si el cliente es viable crediticiamente</li>
  <li>Si el cliente no pasa Preselecta (paso 8), ya gastamos en Rekognition inutilmente</li>
</ul>

<div class="callout callout--danger">
  <p><strong>Riesgo de costo:</strong> Solo el ~13% de las solicitudes mensuales resultan viables en Preselecta. Si las fotos van antes, el 87% del costo de Rekognition seria desperdiciado. Con ~5,000-10,000 solicitudes/mes, esto se acumula rapidamente.</p>
</div>

<h3 id="s3-2">Opcion C: TyC Combinado con Datos Basicos</h3>

<p><strong>Propuesto por:</strong> Miembro del equipo<br>
<strong>Concepto:</strong> Fusionar TyC con un formulario de datos basicos.</p>

<pre><code>① Tipo doc + Nro doc
② Validaciones automaticas
③ Formulario combinado:
   - Nombre, Primer apellido, Segundo apellido
   - Celular
   - Email
   - Fecha expedicion
   - ✓ Acepto politica de tratamiento de datos
   - ✓ Autorizo consulta a centrales de riesgo
   - ✓ Acepto contrato de credito
   - ✓ Acepto contrato de fianza
④ OTP al celular (firma TyC + verificacion)
⑤ Datos complementarios (nacimiento, genero, residencia)
⑥ Validaciones de fondo (antecedentes, Preselecta, FOSIGA)
⑦ Fotos + prueba de vida
⑧ Ubica
⑨ Resultado</code></pre>

<p><strong>Ventajas:</strong></p>
<ul>
  <li>Menos pantallas → experiencia mas rapida</li>
  <li>Un solo formulario con todo lo basico</li>
  <li>El cliente ve progreso mas rapido</li>
</ul>

<p><strong>Desventajas:</strong></p>
<ul>
  <li>Formulario largo puede intimidar</li>
  <li>Legalmente la aceptacion de TyC deberia ser un acto consciente y separado, no mezclado con datos</li>
</ul>

<!-- Mockup Opcion C -->
<p style="margin-top:16px;"><strong>Referencia visual — formulario combinado:</strong></p>
<div class="mockups-row">
  <div class="phone">
    <div class="phone-step">Opcion C — Paso 3</div>
    <div class="phone-title">Datos y Terminos</div>
    <div class="phone-label">Nombre</div>
    <div class="phone-input">Francisco</div>
    <div class="phone-label">Primer apellido</div>
    <div class="phone-input">Garcia</div>
    <div class="phone-label">Celular</div>
    <div class="phone-input">318 456 7890</div>
    <div class="phone-label">Email</div>
    <div class="phone-input">francisco@email.com</div>
    <div class="phone-label">Fecha expedicion</div>
    <div class="phone-input">15/03/2015</div>
    <hr class="phone-divider">
    <div class="phone-check">
      <div class="phone-checkbox phone-checkbox--checked">✓</div>
      <span class="phone-check-text">Politica de tratamiento de datos</span>
    </div>
    <div class="phone-check">
      <div class="phone-checkbox phone-checkbox--checked">✓</div>
      <span class="phone-check-text">Centrales de riesgo</span>
    </div>
    <div class="phone-check">
      <div class="phone-checkbox phone-checkbox--checked">✓</div>
      <span class="phone-check-text">Contrato de credito</span>
    </div>
    <div class="phone-check">
      <div class="phone-checkbox phone-checkbox--checked">✓</div>
      <span class="phone-check-text">Contrato de fianza</span>
    </div>
    <div class="phone-btn">Acepto y continuo</div>
  </div>
  <div style="flex:1;min-width:240px;display:flex;flex-direction:column;justify-content:center;">
    <div class="callout callout--warn" style="margin:0;">
      <p><strong>Riesgo legal:</strong> Mezclar la captura de datos con la aceptacion de terminos puede interpretarse como que el usuario acepto sin leer. La aceptacion de TyC deberia ser un acto consciente y separado.</p>
    </div>
  </div>
</div>

<!-- ==================== OPCION E ==================== -->
<h3 id="s3-3">Opcion D: Foto Frontal Temprana para OCR <span class="badge badge--accent">FLUJO RECOMENDADO</span></h3>

<p><strong>Origen:</strong> Esta opcion nace de la pregunta clave sobre como garantizar que el primer apellido se ingrese correctamente para no malgastar consultas a Preselecta. Preselecta requiere <code>documento + primer apellido exacto + fecha expedicion</code>, y si el usuario escribe mal el apellido (ej: pone ambos apellidos, o con tildes/errores), la consulta se desperdicia.</p>

<p><strong>Concepto:</strong> Capturar SOLO la foto frontal del documento antes del Preselecta para extraer datos con OCR (DetectText). El apellido que se envia a Preselecta proviene del documento, no del usuario. La selfie y el reverso se mantienen despues del Preselecta para no desperdiciar Rekognition completo en clientes no viables.</p>

<pre><code>① Tipo doc + Nro doc → validaciones rapidas (cartera, proceso activo)
② TyC → Celular → OTP (firma electronica)
③ Fecha expedicion documento
④ Foto frontal del documento ← SOLO FOTO FRONTAL
   → OCR (DetectText) o Proceso IA extrae: nombre, primer apellido, segundo apellido
⑤ Confirmar datos extraidos (usuario valida/corrige lo que OCR detecto)
⑥ Datos complementarios (nacimiento, genero, email, residencia)
⑦ Validaciones de fondo (antecedentes, Preselecta con apellido del OCR, FOSIGA)
   → Si NO pasa: FIN (no gastamos selfie ni reverso)
   → Si pasa: continua
⑧ Selfie (prueba de vida) + Foto reverso documento
   → Validacion completa Rekognition (DetectFaces, CompareFaces, SearchFacesByImage, DetectLabels)
   → IA compara datos del reverso con datos ya confirmados
⑨ Ubica
⑩ Resultado</code></pre>

<p><strong>Ventajas:</strong></p>
<ul>
  <li><strong>Primer apellido confiable:</strong> Viene del OCR del documento, no de lo que el usuario tipea. Esto elimina el problema de apellidos mal escritos, con ambos apellidos juntos, o con tildes incorrectas</li>
  <li><strong>Costo minimo:</strong> Solo una llamada a DetectText (~$0.002) antes del Preselecta o a la IA Api Gemini.</li>
  <li><strong>Autocompletado de datos:</strong> Nombre, apellidos y potencialmente fecha de expedicion se pueden autocompletar, reduciendo errores humanos en TODOS los campos criticos</li>
  <li><strong>Mantiene ahorro en Rekognition:</strong> Selfie + reverso (las validaciones que generan costo: CompareFaces, DetectFaces, SearchFacesByImage) siguen despues del Preselecta. Solo el ~13% de solicitudes son viables, asi que nos ahorramos Rekognition completo en el ~87% de los casos</li>
  <li><strong>Mejor UX:</strong> El usuario ve sus datos ya prellenados y solo confirma/corrige, en vez de tipear todo manualmente</li>
</ul>

<p><strong>Desventajas:</strong></p>
<ul>
  <li>Agrega un paso de camara temprano en el flujo, lo que podria aumentar ligeramente el abandono</li>
  <li>Si el OCR falla (foto borrosa, mala iluminacion), el usuario debe tipear manualmente como plan B</li>
</ul>

<!-- MOCKUPS OPCION E -->
<h3 id="s3-3-mockups">Simulacion de pantallas — Opcion D (Recomendado)</h3>
<p>Las pantallas del paso ①, ②, ③ son iguales a la Opcion A. A partir del paso ④ cambia:</p>

<div class="mockups-row">

  <!-- Paso 4: Foto frontal OCR -->
  <div class="phone" style="border-color:var(--accent);">
    <div class="phone-step" style="color:var(--accent);">Opcion D — Paso 4 (NUEVO)</div>
    <div class="phone-title">Foto frontal documento</div>
    <div class="phone-text">Toma una foto clara de la parte frontal de tu cedula para extraer tus datos automaticamente.</div>
    <div class="phone-camera">
      <div class="phone-camera-frame" style="width:150px;height:95px;border-color:var(--accent);">
        <div style="color:rgba(255,255,255,0.3);font-size:11px;text-align:center;">CEDULA DE<br>CIUDADANIA</div>
      </div>
      <div class="phone-camera-text">Ubica el documento dentro del marco</div>
    </div>
    <div class="phone-btn">Capturar foto</div>
    <div class="phone-fields-captured">
      <p>Proceso</p>
      <span>OCR DetectText ~$0.002</span>
    </div>
  </div>

  <!-- Paso 5: Confirmar datos OCR -->
  <div class="phone" style="border-color:var(--accent);">
    <div class="phone-step" style="color:var(--accent);">Opcion D — Paso 5 (NUEVO)</div>
    <div class="phone-title">Confirma tus datos</div>
    <div class="phone-text">Extrajimos estos datos de tu documento. Verifica que sean correctos:</div>
    <div class="phone-label">Nombre</div>
    <div class="phone-input phone-input--filled">FRANCISCO</div>
    <div class="phone-label">Primer apellido</div>
    <div class="phone-input phone-input--filled">GARCIA</div>
    <div class="phone-label">Segundo apellido</div>
    <div class="phone-input phone-input--filled">MARTINEZ</div>
    <div class="phone-label">Fecha de expedicion</div>
    <div class="phone-input phone-input--filled">15/03/2015</div>
    <div class="phone-btn phone-btn--green">Datos correctos, continuar</div>
    <div style="text-align:center;margin-top:8px;">
      <a style="font-size:12px;color:var(--text-secondary);text-decoration:underline;cursor:pointer;">Corregir manualmente</a>
    </div>
    <div class="phone-fields-captured">
      <p>Campos autocompletados via OCR</p>
      <span>first_name</span> <span>last_name</span> <span>second_last_name</span> <span>expedition_date</span>
    </div>
  </div>

  <!-- Paso 6: Datos complementarios -->
  <div class="phone">
    <div class="phone-step">Opcion D — Paso 6</div>
    <div class="phone-title">Datos complementarios</div>
    <div class="phone-text">Completa los datos que no pudimos extraer del documento:</div>
    <div class="phone-label">Fecha de nacimiento</div>
    <div class="phone-input">01/05/1990</div>
    <div class="phone-label">Genero</div>
    <div class="phone-input phone-select">Masculino</div>
    <div class="phone-label">Correo electronico</div>
    <div class="phone-input">francisco@email.com</div>
    <hr class="phone-divider">
    <div class="phone-label">Departamento</div>
    <div class="phone-input phone-select">Cundinamarca</div>
    <div class="phone-label">Ciudad</div>
    <div class="phone-input phone-select">Bogota</div>
    <div class="phone-label">Direccion</div>
    <div class="phone-input">Cra 45 # 23-10</div>
    <div class="phone-label">Barrio</div>
    <div class="phone-input">Chapinero</div>
    <div class="phone-btn">Continuar</div>
    <div class="phone-fields-captured">
      <p>Campos capturados</p>
      <span>birth_date</span> <span>gender_id</span> <span>email</span> <span>department</span> <span>city</span> <span>address</span> <span>neighborhood</span>
    </div>
  </div>

</div>

<div class="mockups-row">

  <!-- Paso 7: Validaciones -->
  <div class="phone">
    <div class="phone-step">Opcion D — Paso 7</div>
    <div class="phone-title">Validaciones de fondo</div>
    <div class="phone-loader">
      <div class="phone-loader-spinner"></div>
      <div class="phone-loader-text">Procesando solicitud...</div>
    </div>
    <div style="font-size:11px;color:var(--text-secondary);line-height:1.8;margin-top:8px;">
      <strong>Secuencia:</strong><br>
      ✓ Antecedentes judiciales<br>
      ✓ Preselecta <strong style="color:var(--accent);">(con apellido del OCR)</strong><br>
      ✓ FOSIGA (condicional)<br><br>
      <span style="color:var(--red)">Si NO pasa → FIN</span><br>
      <span style="color:var(--green)">Si pasa → continua a fotos</span>
    </div>
  </div>

  <!-- Paso 7 FIN -->
  <div class="phone">
    <div class="phone-step" style="color:var(--red);">Opcion D — Paso 7 (si no pasa)</div>
    <div class="phone-title" style="color:var(--red);">Solicitud no viable</div>
    <div class="phone-error">
      <div class="phone-error-icon">&#10060;</div>
      <div class="phone-error-text">No es posible continuar con tu solicitud de credito.</div>
      <div style="font-size:12px;color:var(--text-secondary);margin-top:12px;line-height:1.5;">Lamentablemente, no podemos procesar tu solicitud en este momento. Gracias por tu interes en QUAC.</div>
    </div>
    <div class="callout callout--success" style="margin-top:8px;padding:10px 12px;">
      <p style="font-size:11px;margin:0;"><strong>Ahorro:</strong> No se consumio selfie ni reverso ($0 en Rekognition completo). Solo se gasto ~$0.002 en OCR.</p>
    </div>
  </div>

  <!-- Paso 8: Selfie + Reverso -->
  <div class="phone">
    <div class="phone-step" style="color:var(--green);">Opcion D — Paso 8 (solo viables)</div>
    <div class="phone-title">Prueba de vida y reverso</div>
    <div class="phone-text">Solo llegas aqui si eres viable. Ahora completamos la verificacion:</div>
    <div class="phone-camera" style="height:100px;">
      <div class="phone-camera-frame" style="width:70px;height:70px;border-radius:50%;">
        <div class="phone-camera-icon">&#128100;</div>
      </div>
    </div>
    <div style="font-size:11px;text-align:center;color:var(--text-secondary);margin:4px 0;">Selfie (prueba de vida)</div>
    <div class="phone-camera" style="height:80px;">
      <div class="phone-camera-frame" style="width:120px;height:60px;">
        <div style="color:rgba(255,255,255,0.3);font-size:10px;text-align:center;">REVERSO</div>
      </div>
    </div>
    <div style="font-size:11px;text-align:center;color:var(--text-secondary);margin:4px 0 8px;">Foto reverso documento</div>
    <div class="phone-fields-captured">
      <p>Rekognition completo</p>
      <span>DetectFaces</span> <span>CompareFaces</span> <span>SearchFaces</span> <span>DetectLabels</span>
    </div>
  </div>

</div>

<div class="mockups-row">
  <!-- Paso 9: Ubica -->
  <div class="phone">
    <div class="phone-step">Opcion D — Paso 9</div>
    <div class="phone-title">Verificacion de identidad</div>
    <div class="phone-text">Hola <strong>FRANCISCO</strong>, necesitamos verificar tu identidad. Este proceso es sencillo y seguro.</div>
    <hr class="phone-divider">
    <div class="phone-text">Hemos enviado un codigo SMS al numero <strong>320 *** 456</strong> (registrado en centrales).</div>
    <div class="phone-otp">
      <div class="phone-otp-box">_</div>
      <div class="phone-otp-box">_</div>
      <div class="phone-otp-box">_</div>
      <div class="phone-otp-box">_</div>
    </div>
    <div class="phone-btn">Verificar</div>
    <div class="phone-fields-captured">
      <p>Campos</p>
      <span>ubica_phone</span> <span>ubica_phone_otp</span>
    </div>
  </div>

  <!-- Paso 9b: OTP email Ubica -->
  <div class="phone">
    <div class="phone-step">Opcion D — Paso 9 (cont.)</div>
    <div class="phone-title">Verificacion email</div>
    <div class="phone-text">Hemos enviado un codigo al correo electronico <strong>f***@gmail.com</strong> (registrado en centrales).</div>
    <div class="phone-otp">
      <div class="phone-otp-box">_</div>
      <div class="phone-otp-box">_</div>
      <div class="phone-otp-box">_</div>
      <div class="phone-otp-box">_</div>
    </div>
    <div class="phone-btn">Verificar</div>
    <div class="phone-fields-captured">
      <p>Campos</p>
      <span>ubica_email</span> <span>ubica_email_otp</span>
    </div>
  </div>

  <!-- Paso 10: Resultado -->
  <div class="phone" style="border-color:var(--green);">
    <div class="phone-step" style="color:var(--green);">Opcion D — Paso 10</div>
    <div class="phone-title" style="text-align:center;">Resultado</div>
    <div class="phone-result">
      <img src="assets/quac-1.png" alt="QUAC" style="width:100px;height:auto;margin:0 auto;display:block;">
      <div style="font-size:16px;font-weight:700;color:var(--green);margin-bottom:8px;">¡Felicidades!</div>
      <div style="font-size:13px;color:var(--text-secondary);margin-bottom:12px;">Tu credito ha sido pre-aprobado</div>
      <div class="phone-result-amount">$1.000.000</div>
      <div style="font-size:12px;color:var(--text-secondary);margin-top:12px;line-height:1.5;">Para activar tu credito, acercate a una tienda fisica o realiza tu primera compra en linea.</div>
    </div>
  </div>
</div>

<hr>

<!-- ==================== SECCION 4 ==================== -->
<h2 id="s4">Preguntas clave</h2>

<h3 id="p1">P1: Que pasa si la consulta FOSIGA tarda mas de 2 minutos?</h3>

<p><strong>Opciones:</strong></p>
<ul>
  <li><strong>A) Loader con barra de progreso (Recomendado):</strong> Mostrar progreso estimado con mensajes como "Estamos verificando tu informacion, esto puede tardar unos minutos..."</li>
  <li><strong>B) Enviar a WhatsApp con link para continuar:</strong> Si tarda >30s, mostrar: "Te enviaremos un mensaje de WhatsApp cuando tu verificacion este lista. Haz clic en el link para continuar." Esto evita que el usuario abandone la pagina.</li>
  <li><strong>C) Proceso asincrono:</strong> Continuar el flujo sin esperar FOSIGA. Si FOSIGA falla despues, se envia a fabrica comercial para revision manual.</li>
</ul>

<div class="callout callout--success">
  <p><strong>Sugerencia:</strong> Opcion B con plan B en C. Intentar esperar 30 segundos con loader. Si no responde, enviar WhatsApp con deep link para retomar. Si FOSIGA nunca responde en un tiempo limite (5 min), enviar a fabrica comercial.</p>
</div>

<!-- Mockup FOSIGA -->
<div class="mockups-row">
  <div class="phone">
    <div class="phone-step">FOSIGA — Escenario A</div>
    <div class="phone-title">Esperando respuesta</div>
    <div class="phone-loader">
      <div class="phone-loader-spinner"></div>
      <div class="phone-loader-text">Estamos verificando tu informacion, esto puede tardar unos minutos...</div>
    </div>
    <div style="margin-top:12px;background:var(--code-bg);border-radius:8px;padding:8px;text-align:center;">
      <div style="height:6px;background:var(--border);border-radius:3px;overflow:hidden;">
        <div style="height:100%;width:60%;background:var(--accent);border-radius:3px;"></div>
      </div>
      <div style="font-size:11px;color:var(--text-secondary);margin-top:4px;">~30 segundos</div>
    </div>
  </div>
  <div class="phone">
    <div class="phone-step">FOSIGA — Escenario B</div>
    <div class="phone-title">Timeout > 30s</div>
    <div class="phone-text" style="text-align:center;padding:12px 0;">Tu verificacion esta tomando mas tiempo de lo esperado.</div>
    <div style="text-align:center;font-size:36px;margin:8px 0;">&#128172;</div>
    <div class="phone-text" style="text-align:center;">Te enviaremos un mensaje de <strong>WhatsApp</strong> cuando tu verificacion este lista. Haz clic en el link para continuar.</div>
    <div class="phone-btn phone-btn--green">Entendido</div>
  </div>
</div>

<hr>

<h3 id="p2">P2: Que pasa si el correo de Ubica es diferente al registrado en el paso de datos personales?</h3>

<p><strong>Opciones:</strong></p>
<ul>
  <li><strong>A) Actualizar el email con el de Ubica (NO recomendado):</strong> Se pierde el email que el cliente proporciono voluntariamente.</li>
  <li><strong>B) Guardar ambos (Recomendado):</strong> Mantener el email del cliente como <code>client_email</code> y agregar <code>ubica_email</code> como campo separado. El email de Ubica es de centrales de riesgo y puede estar desactualizado.</li>
  <li><strong>C) Preguntar al cliente cual email prefiere:</strong> Mostrar ambos y dejar que elija.</li>
</ul>

<div class="callout callout--success">
  <p><strong>Sugerencia:</strong> Opcion B. El email de Ubica se usa exclusivamente para verificacion de identidad (enviar OTP). El email del cliente (<code>client_email</code>) es el de contacto y comunicaciones. Son propositos diferentes.</p>
</div>

<hr>

<h3 id="p3">P3: Si el cliente abandona, puede retomar el proceso desde el paso donde abandono?</h3>

<p><strong>Opciones:</strong></p>
<ul>
  <li><strong>A) Si, desde el paso donde abandono:</strong> El backend ya tiene el <code>slug_step</code> (paso actual) o equivalente. Al volver con el mismo link, el sistema detecta el paso actual y lo retoma.</li>
  <li><strong>B) Si, pero desde el inicio:</strong> Se valida documento, detecta solicitud existente, y reinicia.</li>
  <li><strong>C) No, debe empezar de nuevo:</strong> Se invalida la solicitud anterior.</li>
</ul>

<div class="callout callout--success">
  <p><strong>Sugerencia:</strong> Opcion A. El sistema actual ya tiene el mecanismo (<code>slug_step</code>). Retomar desde donde abandono reduce la friccion y evita repetir pasos ya completados.</p>
</div>

</div><!-- .main -->

<!-- Sidebar highlight on scroll -->
<script>
(function() {
  const links = document.querySelectorAll('.sidebar nav a');
  const ids = [];
  links.forEach(a => {
    const href = a.getAttribute('href');
    if (href && href.startsWith('#')) ids.push({ el: document.getElementById(href.slice(1)), link: a });
  });
  function onScroll() {
    const main = document.querySelector('.main');
    const scrollY = window.scrollY + 100;
    let current = null;
    ids.forEach(item => {
      if (item.el && item.el.offsetTop <= scrollY) current = item;
    });
    links.forEach(l => l.classList.remove('active'));
    if (current) current.link.classList.add('active');
  }
  window.addEventListener('scroll', onScroll, { passive: true });
  onScroll();
})();
</script>

</body>
</html>
